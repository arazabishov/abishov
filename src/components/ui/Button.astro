---
import type { HTMLAttributes } from "astro/types";

interface ButtonProps extends HTMLAttributes<"button"> {
  variant?: "outline" | "ghost";
  size?: "default" | "sm" | "lg" | "icon";
}

interface LinkProps extends HTMLAttributes<"a"> {
  href: string;
  external?: boolean;
  variant?: "outline" | "ghost";
  size?: "default" | "sm" | "lg" | "icon";
}

type Props = ButtonProps | LinkProps;

function isLink(props: Props): props is LinkProps {
  return "href" in props && typeof props.href === "string";
}

const { variant = "outline", size = "default", class: className, ...rest } = Astro.props;

const baseClasses = [
  "inline-flex",
  "items-center",
  "justify-center",
  "gap-2",
  "whitespace-nowrap",
  "rounded-md",
  "text-sm",
  "font-medium",
  "transition-[background-color,border-color,color,opacity]",
  "duration-200",
  "disabled:pointer-events-none",
  "disabled:opacity-50",
  "[&_svg]:pointer-events-none",
  "[&_svg:not([class*='size-'])]:size-4",
  "shrink-0",
  "[&_svg]:shrink-0",
  "outline-none",
];

const variantClasses: Record<string, string[]> = {
  outline: [
    "border",
    "bg-background",
    "hover:bg-muted",
    "hover:text-foreground",
    "dark:bg-input/30",
    "dark:border-input",
    "dark:hover:bg-input/50",
  ],
  ghost: ["hover:bg-muted", "hover:text-foreground", "dark:hover:bg-muted/50"],
};

const sizeClasses: Record<string, string> = {
  default: "h-9 px-4 py-2 has-[>svg]:px-3",
  sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
  lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
  icon: "size-9",
};

const classes = [baseClasses, variantClasses[variant], sizeClasses[size], className];
---

{
  isLink(Astro.props) ? (
    <a href={Astro.props.href} target={Astro.props.external ? "_blank" : "_self"} class:list={classes} {...rest}>
      <slot />
    </a>
  ) : (
    <button class:list={classes} {...(rest as HTMLAttributes<"button">)}>
      <slot />
    </button>
  )
}
