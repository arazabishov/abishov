---
import { getHeadingMargin } from "@/core/utils";
import type { MarkdownHeading } from "astro";

type Props = {
  headings: MarkdownHeading[];
};

const { headings } = Astro.props;
---

{
  headings.length > 0 && (
    <div
      id="toc-sidebar-container"
      class="sticky top-20 col-start-1 row-span-1 mr-8 ml-auto hidden h-[calc(100vh-5rem)] max-w-md xl:block"
    >
      <div
        id="toc-sidebar-scroll-area"
        class="flex max-h-[calc(100vh-8rem)] flex-col overflow-y-auto"
      >
        <div class="flex flex-col gap-2 px-4">
          <span class="text-lg font-medium">Table of Contents</span>
          <ul class="flex list-none flex-col gap-y-2">
            {headings.map((heading) => (
              <li
                class:list={[
                  "text-sm",
                  getHeadingMargin(heading.depth),
                  "text-foreground/60",
                ]}
              >
                <a
                  href={`#${heading.slug}`}
                  class="marker:text-foreground/30 list-none underline decoration-transparent underline-offset-[3px] transition-colors duration-200 hover:decoration-inherit"
                  data-heading-link={heading.slug}
                >
                  {heading.text}
                </a>
              </li>
            ))}
          </ul>
        </div>
      </div>
    </div>
  )
}

<script>
  import { initSidebarTOC } from "@/scripts/toc";

  let cleanup: (() => void) | undefined;

  function init() {
    cleanup?.();
    cleanup = initSidebarTOC();
  }

  document.addEventListener("astro:page-load", init);
  document.addEventListener("astro:before-swap", () => cleanup?.());
</script>
