@import "tailwindcss";
@plugin "@tailwindcss/typography";

/* Apply dark: styles when data-theme="dark" is present on the element or an ancestor */
@custom-variant dark (&:where([data-theme=dark], [data-theme=dark] *));

/* Colors are defined in oklch(Lightness Chroma Hue) for better perceptual uniformity and wider gamut support */
:root {
  --background: oklch(1 0 0);
  --foreground: oklch(0.145 0 0);
  --primary: oklch(0.205 0 0);
  --primary-foreground: oklch(0.985 0 0);
  --muted: oklch(0.97 0 0);
  --muted-foreground: oklch(0.556 0 0);
  --border: oklch(0.922 0 0);
  --ring: oklch(0.708 0 0);
}

/* Dark mode overrides: these values replace the :root values when the theme is dark */
[data-theme="dark"] {
  --background: oklch(0.145 0 0);
  --foreground: oklch(0.985 0 0);
  --primary: oklch(0.922 0 0);
  --primary-foreground: oklch(0.205 0 0);
  --muted: oklch(0.269 0 0);
  --muted-foreground: oklch(0.708 0 0);
  --border: oklch(1 0 0 / 10%);
  --ring: oklch(0.556 0 0);
}

@theme inline {
  /* Map Astro's font variables to Tailwind's theme */
  --font-sans: var(--font-geist);
  --font-mono: var(--font-geist-mono);

  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-border: var(--border);
  --color-ring: var(--ring);
}

@layer base {
  /* Reserve space for scrollbar to prevent layout shift when navigating between pages */
  html {
    scrollbar-gutter: stable;
  }

  /* Global defaults for all elements, pseudo-elements, and UI controls */
  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    /* Sets default border color to theme's border color */
    @apply border-border;
    /* Sets focus outline color to theme's ring color at 50% opacity */
    @apply outline-ring/50;
    /* Reduces letter-spacing for a more compact, modern look */
    @apply tracking-tight;
  }

  /* Prevent long words from overflowing their container by allowing breaks */
  p,
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    @apply wrap-break-word;
  }

  /* Balance line lengths in headings for better visual rhythm */
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    @apply text-balance;
  }

  /* Improve paragraph readability by avoiding orphans and awkward line breaks */
  p {
    @apply text-pretty;
  }
}

/* Override typography plugin's default colors with our theme */
@layer utilities {
  .prose {
    --tw-prose-body: var(--foreground);
    --tw-prose-headings: var(--foreground);
    --tw-prose-lead: var(--muted-foreground);
    --tw-prose-links: var(--foreground);
    --tw-prose-bold: var(--foreground);
    --tw-prose-counters: oklch(from var(--foreground) l c h / 30%);
    --tw-prose-bullets: oklch(from var(--foreground) l c h / 30%);
    --tw-prose-hr: var(--border);
    --tw-prose-quotes: var(--muted-foreground);
    --tw-prose-quote-borders: var(--border);
    --tw-prose-captions: var(--muted-foreground);
    --tw-prose-kbd: var(--foreground);
    --tw-prose-kbd-shadows: var(--foreground);
    --tw-prose-code: var(--foreground);
    --tw-prose-pre-code: var(--foreground);
    --tw-prose-pre-bg: var(--muted);
    --tw-prose-th-borders: var(--border);
    --tw-prose-td-borders: var(--border);

    /* Inline code styling */
    & :where(code) {
      @apply bg-muted/50 rounded-sm px-[0.3rem] py-[0.2rem] text-sm font-medium;
    }

    & :where(code)::before,
    & :where(code)::after {
      content: none;
    }

    /* Headings */
    & :where(h1, h2, h3, h4, h5, h6) {
      @apply scroll-mt-32 font-medium xl:scroll-mt-20;
    }

    /* Links */
    & :where(a) {
      @apply decoration-muted-foreground hover:decoration-foreground underline-offset-[3px] transition-colors;
    }

    /* Blockquotes */
    & :where(blockquote) {
      @apply border-l-2 pl-6 not-italic;
    }

    /* Images and code blocks */
    & :where(img, video, figure, .expressive-code) {
      @apply mx-auto;
    }

    /* Pre blocks */
    & :where(pre) {
      @apply max-h-[min(68vh,1000px)]! overflow-y-auto;
    }

    /* Keyboard */
    & :where(kbd) {
      @apply bg-muted rounded-md border px-2 py-1 text-xs;
    }
  }
}
